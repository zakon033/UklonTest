<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Uklon ‚Äî –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Uklon –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png">

<link rel="manifest" href="manifest.json">

<style>
  /* --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ (–°–í–ï–¢–õ–ê–Ø –¢–ï–ú–ê) --- */
  :root{
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
    --bg:#f2f4f7;
    --card:#ffffff;
    --accent:#0066ff;
    
    /* –¢–µ–∫—Å—Ç—ã */
    --main-text:#000000;
    --muted-text:#6b6b6b; 
    
    /* –ì—Ä–∞–Ω–∏—Ü—ã –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
    --border-color:#d8dce3;
    --panel-border:#e7e9ee;
    --line-divider:#eee;
    
    /* –¶–≤–µ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π */
    --green:#c8f5c2;
    --red:#ffd4d4;
    --good:#0c7a27;
    --bad:#a80000;
    
    /* –≠–ª–µ–º–µ–Ω—Ç—ã .zero */
    --zero-bg:#f4f4f4;
    --zero-border:#ccc;
    --zero-text:#555;
    --small-btn-bg:#eee;
  }

  /* --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –¢–ï–ú–ù–û–ô –¢–ï–ú–´ --- */
  .dark-theme{
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
    --bg:#121212;
    --card:#1f1f1f;
    --accent:#5599ff;
    
    /* –¢–µ–∫—Å—Ç—ã */
    --main-text:#f0f0f0;
    --muted-text:#a0a0a0; /* –ó–º—ñ–Ω–µ–Ω–æ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É –≤ —Ç–µ–º–Ω—ñ–π —Ç–µ–º—ñ */
    
    /* –ì—Ä–∞–Ω–∏—Ü—ã –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
    --border-color:#333;
    --panel-border:#2e2e2e;
    --line-divider:#333;
    
    /* –¶–≤–µ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π */
    --green:#1a3a1f; 
    --red:#472c2c; 
    --good:#5fb371; 
    --bad:#ff7575; 
    
    /* –≠–ª–µ–º–µ–Ω—Ç—ã .zero */
    --zero-bg:#2d2d2d;
    --zero-border:#444;
    --zero-text:#a0a0a0;
    --small-btn-bg:#333;
  }
  
  /* --- –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò (–û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–ª—è –æ–±–µ–∏—Ö —Ç–µ–º) --- */
  body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
    background:var(--bg);
    margin:0;
    padding:0;
    color: var(--main-text); 
  }
  
  /* –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã, –∫–æ–≥–¥–∞ –∫–ª–∞—Å—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω */
  .dark-theme body {
    background: var(--bg);
    color: var(--main-text);
  }

  .wrap{max-width:600px;margin:0 auto;padding:16px;}
  h1{text-align:center;margin:0 0 16px;font-size:22px;font-weight:700;}

  .card{
    background:var(--card);
    border-radius:16px;
    padding:18px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    margin-bottom:16px;
  }

  /* –î–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã —Ç–µ–Ω–∏ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –º–µ–Ω–µ–µ –∑–∞–º–µ—Ç–Ω—ã–º–∏ */
  .dark-theme .card {
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }

  label{font-size:15px;color:var(--muted-text);margin-bottom:6px;display:block;}

  input[type="number"]{
    width:100%;
    padding:14px 12px;
    font-size:18px;
    border-radius:12px;
    border:1px solid var(--border-color);
    margin-bottom:12px;
    box-sizing:border-box;
    background: var(--card);
    color: var(--main-text);
  }

  input[type="number"]:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(0,102,255,0.2);
  }

  /* --- –°–¢–ò–õ–ò –î–õ–Ø –†–Ø–î–ê –ö–ù–û–ü–û–ö --- */
  .button-row {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .btn{
    width:100%;
    padding:14px;
    border-radius:12px;
    background:var(--accent);
    border:0;
    color:white;
    font-size:18px;
    font-weight:600;
    flex-grow: 1; 
  }
  
  .small-icon-btn {
    padding: 14px;
    border-radius: 12px;
    border: 0;
    color: white; 
    cursor: pointer;
    flex-shrink: 0; 
  }
  .small-icon-btn.red {
    background: var(--bad); 
  }
  .small-icon-btn svg {
    display: block;
  }
  /* --- –ö–û–ù–ï–¶ –°–¢–ò–õ–ï–ô –î–õ–Ø –†–Ø–î–ê –ö–ù–û–ü–û–ö --- */

  .results{display:flex;flex-direction:column;gap:16px;}

  .panel{
    background:var(--card);
    border-radius:16px;
    padding:16px;
    border:1px solid var(--panel-border);
  }

  .panel h3{margin:0 0 10px;font-size:18px;}

  .line{
    display:flex;
    justify-content:space-between;
    padding:8px 0;
    font-size:16px;
    border-top:1px solid var(--line-divider);
  }
  .line:first-of-type{border-top:0;padding-top:0;}

  .val{font-weight:700;}

  .diff{
    padding:6px 12px;
    border-radius:10px;
    min-width:90px;
    text-align:center;
    display:inline-block;
    font-weight:600;
  }

  .zero{
    background:var(--zero-bg);
    border:1px dashed var(--zero-border);
    color:var(--zero-text);
  }

  textarea{
    width: 100%;
    margin: 10px 0 0; /* –ó–º–µ–Ω—à–µ–Ω–∏–π –Ω–∏–∂–Ω—ñ–π –≤—ñ–¥—Å—Ç—É–ø */
    height: 140px;
    border-radius: 10px;
    padding: 10px;
    font-size: 14px;
    border: 1px solid var(--border-color);
    box-sizing: border-box;
    display: block;
    background: var(--card);
    color: var(--main-text);
  }

  .row{display:flex;gap:10px;}
  .small-btn{
    padding:8px 12px;
    border-radius:8px;
    border:0;
    background:var(--small-btn-bg);
    color: var(--main-text);
    cursor:pointer;
  }
  
  /* --- –ù–û–í–Ü –°–¢–ò–õ–Ü –î–õ–Ø –†–Ø–î–ê –ö–ù–û–ü–ö–ò –ö–û–ü–Ü–Æ–í–ê–ù–ù–Ø –Ü –°–ß–ï–¢–ß–ò–ö–ê --- */
  .copy-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 8px; 
    margin-bottom: 5px;
  }

  .char-count {
    font-size: 14px;
    color: var(--muted-text); /* –°—ñ—Ä–∏–π –∫–æ–ª—ñ—Ä, –Ω–µ —Å–∏–ª—å–Ω–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ —Ñ–æ–Ω—É */
    padding: 5px 0;
    min-width: 40px; 
  }

  .char-count.limit-ok {
    color: var(--muted-text);
  }

  .char-count.limit-exceeded {
    color: var(--bad); /* –ß–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä */
    font-weight: 700;
  }
  /* --- –ö–Ü–ù–ï–¶–¨ –ù–û–í–ò–• –°–¢–ò–õ–Ü–í --- */
  
  /* --- –°—Ç–∏–ª–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π --- */
  .toggle-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 12px 0 6px;
    font-size: 16px;
  }

  #extraFields {
    overflow: hidden;
    max-height: 0;
    padding: 0;
    transition: max-height 0.35s ease, padding 0.25s ease;
  }

  #extraFields.open {
    max-height: 300px;
    padding: 10px 0;
  }

  #extraFields label {
    display: block;
    margin: 8px 0 4px;
  }

  #extraFields input {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid var(--border-color);
    font-size: 16px;
    box-sizing: border-box;
    background: var(--card);
    color: var(--main-text);
  }
  
  /* --- CSS –î–õ–Ø –ö–ê–°–¢–û–ú–ù–û–ì–û –°–õ–ê–ô–î–ï–†–ê (TOGGLE SWITCH) --- */
  .switch {
    position: relative;
    display: inline-block;
    width: 50px; 
    height: 28px; 
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    transition: .4s;
    border-radius: 28px;
    background-color: var(--zero-bg); 
    border: 1px solid var(--zero-border);
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 3px;
    background-color: white; 
    transition: .4s;
    border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }

  /* –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
  input:checked + .slider {
    background-color: var(--accent);
    border-color: var(--accent);
  }

  input:checked + .slider:before {
    transform: translateX(20px);
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤ Uklon</h1>

  <div class="card">
    <label>–§–∞–∫—Ç–∏—á–Ω–∞ —Å—É–º–∞, –≥—Ä–Ω</label>
    <input id="actual" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 155">

    <label>–ü—Ä–æ–±—ñ–≥, –∫–º</label>
    <input id="distance" type="number" inputmode="decimal" step="0.01" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 3.0">

    <label>–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç</label>
    <input id="coef" type="number" inputmode="decimal" step="0.01" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 1.06">

    <label class="toggle-row">
      <span>–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</span>
      <label class="switch">
        <input type="checkbox" id="extraToggle">
        <span class="slider"></span>
      </label>
    </label>

    <div id="extraFields">
      <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–ª–∞—Ç–Ω–∏—Ö —Ö–≤–∏–ª–∏–Ω</label>
      <input id="paidMinutes" type="number" step="1" placeholder="–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ">

      <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö —Ç–æ—á–æ–∫</label>
      <input id="midPoints" type="number" step="1" placeholder="–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ">
    </div>

    <div class="button-row">
      <button class="small-icon-btn red" id="clearBtn" title="–û—á–∏—Å—Ç–∏—Ç–∏">
        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M16 9v10H8V9h8m-1.5-6h-5L9 4H7v2h10V4h-2l-1.5-3zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/>
        </svg>
      </button>
      <button class="btn" id="calcBtn">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
    </div>
  </div>

  <div class="card">
    <label class="toggle-row">
      <span>–¢–µ–º–Ω–∞ —Ç–µ–º–∞</span>
      <label class="switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
    </label>
  </div>

  <div class="results">
    <div class="panel">
      <h3>–°—Ç–∞–Ω–¥–∞—Ä—Ç</h3>
      <div class="line"><span>–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞</span><span class="val" id="stdCalc">‚Äî</span></div>
      <div class="line"><span>–†—ñ–∑–Ω–∏—Ü—è</span><span class="diff zero" id="stdDiff">‚Äî</span></div>
      <textarea id="stdMsg" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∑ º—è–≤–∏—Ç—å—Å—è —Ç—É—Ç"></textarea>
      <div class="copy-row">
        <button class="small-btn" id="copyStd">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        <span class="char-count" id="stdCharCount">‚Äî</span>
      </div>
    </div>

    <div class="panel">
      <h3>–ö–æ–º—Ñ–æ—Ä—Ç</h3>
      <div class="line"><span>–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞</span><span class="val" id="cfCalc">‚Äî</span></div>
      <div class="line"><span>–†—ñ–∑–Ω–∏—Ü—è</span><span class="diff zero" id="cfDiff">‚Äî</span></div>
      <textarea id="cfMsg" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∑ º—è–≤–∏—Ç—å—Å—è —Ç—É—Ç"></textarea>
      <div class="copy-row">
        <button class="small-btn" id="copyCf">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        <span class="char-count" id="cfCharCount">‚Äî</span>
      </div>
    </div>

    <div class="panel">
      <h3>–ë—ñ–∑–Ω–µ—Å</h3>
      <div class="line"><span>–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞</span><span class="val" id="bizCalc">‚Äî</span></div>
      <div class="line"><span>–†—ñ–∑–Ω–∏—Ü—è</span><span class="diff zero" id="bizDiff">‚Äî</span></div>
      <textarea id="bizMsg" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∑ º—è–≤–∏—Ç—å—Å—è —Ç—É—Ç"></textarea>
      <div class="copy-row">
        <button class="small-btn" id="copyBiz">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
        <span class="char-count" id="bizCharCount">‚Äî</span>
      </div>
    </div>

  </div>
</div>

<script>
const STD = {minKm:1.9, base:105, perKm:17.6, name:"–°—Ç–∞–Ω–¥–∞—Ä—Ç", extraMinute:3, extraPoint:10};
const CFM = {minKm:2.1, base:115, perKm:20.4, name:"–ö–æ–º—Ñ–æ—Ä—Ç", extraMinute:3, extraPoint:10};
const BIZ = {minKm:1.6, base:140, perKm:24.2, name:"–ë—ñ–∑–Ω–µ—Å", extraMinute:4, extraPoint:10};
const CHAR_LIMIT = 250; // –õ—ñ–º—ñ—Ç —Å–∏–º–≤–æ–ª—ñ–≤

function calcFare(km, t){
  return km <= t.minKm ? t.base : t.base + (km - t.minKm) * t.perKm;
}

function fmt(x){
  return isNaN(x) ? "‚Äî" : x.toFixed(2) + " ‚Ç¥";
}

function colorize(el, v){
  el.className = "diff";
  if(isNaN(v)){
    el.classList.add("zero");
    el.textContent = "‚Äî";
    return;
  }

  el.textContent = v.toFixed(2) + " ‚Ç¥";

  if(v > 0){
    el.style.background = "var(--green)";
    el.style.color = "var(--good)";
  } 
  else if(v < 0){
    el.style.background = "var(--red)";
    el.style.color = "var(--bad)";
  }
  else {
    el.classList.add("zero");
    el.style.background = ""; 
    el.style.color = ""; 
  }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ —Å–∏–º–≤–æ–ª—ñ–≤
function updateCharCount(taId, countId, limit = CHAR_LIMIT){
  const ta = document.getElementById(taId);
  const countEl = document.getElementById(countId);
  
  if (!ta || !countEl) return;
  
  const currentCount = ta.value.length;
  countEl.textContent = `${currentCount}/${limit}`;
  countEl.className = 'char-count'; // –°–∫–∏–¥–∞–Ω–Ω—è –∫–ª–∞—Å—ñ–≤
  
  if (currentCount === 0) {
    countEl.textContent = '‚Äî'; // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –ø—Ä–æ—á–µ—Ä–∫, –∫–æ–ª–∏ –ø–æ–ª–µ –ø–æ—Ä–æ–∂–Ω—î
  } else if (currentCount > limit) {
    // –Ø–∫—â–æ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ - —á–µ—Ä–≤–æ–Ω–∏–π
    countEl.classList.add('limit-exceeded');
  } else {
    // –Ø–∫—â–æ –≤ –Ω–æ—Ä–º—ñ - —Å—ñ—Ä–∏–π (muted-text)
    countEl.classList.add('limit-ok');
  }
}


function getGreeting() {
  const h = new Date().getHours();

  if (h >= 5 && h < 12) return "–î–æ–±—Ä–æ–≥–æ —Ä–∞–Ω–∫—É!üå§Ô∏è";
  if (h >= 12 && h < 17) return "–î–æ–±—Ä–æ–≥–æ –¥–Ω—è!üå§Ô∏è";
  if (h >= 17 && h < 23) return "–î–æ–±—Ä–æ–≥–æ –≤–µ—á–æ—Ä–∞!üåô‚ú®";
  return "–î–æ–±—Ä–æ—ó –Ω–æ—á—ñ!‚ú®üåô";
}

function genMsg(t, km, coef, actual, paidMinutes, midPoints){
  const baseFare = calcFare(km, t);
  let total = baseFare * coef;

  let lines = [`‚Ä¢ (${t.base} + (${km.toFixed(2)} - ${t.minKm}) √ó ${t.perKm}) √ó ${coef.toFixed(2)} = ${(baseFare*coef).toFixed(2)}üíµ`];

  if(paidMinutes > 0){
    let addPaid = paidMinutes * t.extraMinute;
    lines.push(`‚Ä¢ –ü–ª–∞—Ç–Ω—ñ —Ö–≤. (${paidMinutes} √ó ${t.extraMinute}üíµ) = ${addPaid.toFixed(2)}üíµ`);
    total += addPaid;
  }
  if(midPoints > 0){
    let addPoints = midPoints * t.extraPoint;
    lines.push(`‚Ä¢ –ü—Ä–æ–º—ñ–∂–Ω—ñ —Ç–æ—á–∫–∏ (${midPoints} √ó ${t.extraPoint}üíµ) = ${addPoints.toFixed(2)}üíµ`);
    total += addPoints;
  }

  const diff = total - actual;
  // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –ª–∏—à–µ, —è–∫—â–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞ > —Ñ–∞–∫—Ç–∏—á–Ω–æ—ó
  if(diff <= 0) return ""; 

  const greeting = getGreeting();

  return `${greeting}
–ü—Ä–æ—à—É –¥–æ–Ω–∞—Ä–∞—Ö—É–≤–∞—Ç–∏ ${diff.toFixed(2)}üíµ.
–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞ - ${total.toFixed(2)}üíµ:
${lines.join("\n")}
–§–∞–∫—Ç–∏—á–Ω–∞ ‚Äî ${actual.toFixed(2)}üíµ
–©–∏—Ä–æ –¥—è–∫—É—é!ü§ó`;
}

function bindCopy(btnId, taId){
  const btn = document.getElementById(btnId);
  btn.onclick = function(){
    const t = document.getElementById(taId);
    if(!t.value){
      alert('–ù–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è');
      return;
    }
    if (t.value.length > CHAR_LIMIT) {
      alert(`–£–≤–∞–≥–∞: –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–≤–∏—â—É—î –ª—ñ–º—ñ—Ç ${CHAR_LIMIT} —Å–∏–º–≤–æ–ª—ñ–≤. –ü–æ—Ç–æ—á–Ω–∞ –¥–æ–≤–∂–∏–Ω–∞: ${t.value.length}.`);
    }
    t.select();
    t.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(t.value).then(
      () => alert('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'),
      () => { document.execCommand('copy'); alert('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ'); }
    );
  };
}

bindCopy('copyStd','stdMsg');
bindCopy('copyCf','cfMsg');
bindCopy('copyBiz','bizMsg');

document.getElementById("calcBtn").onclick = function(){
  const actual = parseFloat(document.getElementById("actual").value);
  const km = parseFloat(document.getElementById("distance").value);
  const coef = parseFloat(document.getElementById("coef").value);
  const paidMinutes = parseInt(document.getElementById("paidMinutes").value) || 0;
  const midPoints = parseInt(document.getElementById("midPoints").value) || 0;

  if(isNaN(km) || isNaN(coef) || isNaN(actual)){
    alert("–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ");
    return;
  }

  const totals = {
    std: calcFare(km, STD) * coef + paidMinutes*STD.extraMinute + midPoints*STD.extraPoint,
    cf: calcFare(km, CFM) * coef + paidMinutes*CFM.extraMinute + midPoints*CFM.extraPoint,
    biz: calcFare(km, BIZ) * coef + paidMinutes*BIZ.extraMinute + midPoints*BIZ.extraPoint
  };

  document.getElementById("stdCalc").textContent = fmt(totals.std);
  document.getElementById("cfCalc").textContent = fmt(totals.cf);
  document.getElementById("bizCalc").textContent = fmt(totals.biz);

  // –î–ª—è —Ä–∞–∑–Ω–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è - —Ä–∞—Å—á–µ—Ç–Ω–∞—è (Actual - Calculated)
  colorize(document.getElementById("stdDiff"), actual - totals.std);
  colorize(document.getElementById("cfDiff"), actual - totals.cf);
  colorize(document.getElementById("bizDiff"), actual - totals.biz);

  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
  document.getElementById('stdMsg').value = genMsg(STD, km, coef, actual, paidMinutes, midPoints);
  document.getElementById('cfMsg').value = genMsg(CFM, km, coef, actual, paidMinutes, midPoints);
  document.getElementById('bizMsg').value = genMsg(BIZ, km, coef, actual, paidMinutes, midPoints);
  
  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ —Å–∏–º–≤–æ–ª—ñ–≤
  updateCharCount('stdMsg', 'stdCharCount');
  updateCharCount('cfMsg', 'cfCharCount');
  updateCharCount('bizMsg', 'bizCharCount');
};

document.getElementById("clearBtn").onclick = function(){
  // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—ñ–≤ –≤–≤–æ–¥—É —ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
  document.getElementById("actual").value = '';
  document.getElementById("distance").value = '';
  document.getElementById("coef").value = '';
  document.getElementById("paidMinutes").value = '';
  document.getElementById("midPoints").value = '';
  
  document.getElementById("stdCalc").textContent = '‚Äî';
  document.getElementById("cfCalc").textContent = '‚Äî';
  document.getElementById("bizCalc").textContent = '‚Äî';
  
  colorize(document.getElementById("stdDiff"), NaN);
  colorize(document.getElementById("cfDiff"), NaN);
  colorize(document.getElementById("bizDiff"), NaN);
  
  document.getElementById('stdMsg').value = '';
  document.getElementById('cfMsg').value = '';
  document.getElementById('bizMsg').value = '';
  
  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ —Å–∏–º–≤–æ–ª—ñ–≤
  updateCharCount('stdMsg', 'stdCharCount');
  updateCharCount('cfMsg', 'cfCharCount');
  updateCharCount('bizMsg', 'bizCharCount');
  
  const extraToggle = document.getElementById('extraToggle');
  const extraFields = document.getElementById('extraFields');
  if (extraToggle.checked) {
    extraToggle.checked = false;
    extraFields.classList.remove('open');
  }
};


document.getElementById('extraToggle').addEventListener('change', function () {
  const extra = document.getElementById('extraFields');
  const paidInput = document.getElementById('paidMinutes');
  const midInput = document.getElementById('midPoints');

  if (this.checked) {
    extra.classList.add('open');
  } else {
    extra.classList.remove('open');
    paidInput.value = '';
    midInput.value = '';
  }
});


// --- –§–£–ù–ö–¶–ò–û–ù–ê–õ –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –¢–ï–ú–´ ---
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
const THEME_KEY = 'uklonTheme';

// 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
function setInitialTheme() {
  const savedTheme = localStorage.getItem(THEME_KEY);
  
  if (savedTheme === 'dark') {
    body.classList.add('dark-theme');
    themeToggle.checked = true;
  } 
}

// 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
themeToggle.addEventListener('change', function () {
  if (this.checked) {
    // –í–∫–ª—é—á–∞–µ–º —Ç—ë–º–Ω—É—é —Ç–µ–º—É
    body.classList.add('dark-theme');
    localStorage.setItem(THEME_KEY, 'dark');
  } else {
    // –í–∫–ª—é—á–∞–µ–º —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É
    body.classList.remove('dark-theme');
    localStorage.setItem(THEME_KEY, 'light');
  }
});

// –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞
setInitialTheme();


// PWA Service Worker registration
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log('Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π'))
    .catch(err => console.log('Service Worker –ø–æ–º–∏–ª–∫–∞:', err));
}
</script>
</body>
</html>

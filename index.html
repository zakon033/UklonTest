<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Uklon ‚Äî –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Uklon –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png">
<link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png">

<link rel="manifest" href="manifest.json">

<style>
  /* --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ (–°–í–ï–¢–õ–ê–Ø –¢–ï–ú–ê) --- */
  :root{
    --bg:#f2f4f7;
    --card:#ffffff;
    --accent:#0066ff;
    --main-text:#000000;
    --muted-text:#6b6b6b; 
    --border-color:#d8dce3;
    --panel-border:#e7e9ee;
    --line-divider:#eee;
    --green:#c8f5c2;
    --red:#ffd4d4;
    --good:#0c7a27;
    --bad:#a80000;
    --zero-bg:#f4f4f4;
    --zero-border:#ccc;
    --zero-text:#555;
    --small-btn-bg:#eee;
  }

  /* --- –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê (–ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø) --- */
  html[data-theme="dark"]{
    --bg: #1c1c1e;
    --card: #2c2c2e;
    --main-text:#ffffff;
    --muted-text:#ffffff;
    --border-color:#555;
    --panel-border:#555;
    --line-divider:#444;
    --green: #2d4538;
    --red: #4a2c2c;
    --good: #57d657;
    --bad: #ff6666;
    --zero-bg: #444;
    --zero-border: #777;
    --zero-text: #ccc;
    --small-btn-bg: #444;
  }

  html[data-theme="dark"] .card{
    box-shadow: 0 4px 12px rgba(0,0,0,0.4); 
  }

  html[data-theme="dark"] input[type="number"]:focus{
    box-shadow:0 0 0 2px rgba(0,136,255,0.4);
  }

  html[data-theme="dark"] .slider:before {
    background-color: #f2f2f7; 
  }

  body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
    background:var(--bg);
    margin:0;
    padding:0;
    color: var(--main-text);
  }

  .wrap{max-width:600px;margin:0 auto;padding:16px;}
  h1{text-align:center;margin:0 0 16px;font-size:22px;font-weight:700;}

  .card{
    background:var(--card);
    border-radius:16px;
    padding:18px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    margin-bottom:16px;
  }

  label{font-size:15px;color:var(--muted-text);margin-bottom:6px;display:block;}

  input[type="number"]{
    width:100%;
    padding:14px 12px;
    font-size:18px;
    border-radius:12px;
    border:1px solid var(--border-color);
    margin-bottom:12px;
    background: var(--card);
    color: var(--main-text);
  }

  input[type="number"]:focus{
    outline:none;
    border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(0,102,255,0.2);
  }

  .button-row { display:flex; gap:10px; align-items:center; }

  .btn{
    width:100%;
    padding:14px;
    border-radius:12px;
    background:var(--accent);
    border:0;
    color:white;
    font-size:18px;
    font-weight:600;
    flex-grow:1;
  }

  .small-icon-btn {
    padding:14px;
    border-radius:12px;
    border:0;
    color:white;
  }
  .small-icon-btn.red { background:var(--bad); }

  .results{display:flex;flex-direction:column;gap:16px;}
  .panel{
    background:var(--card);
    border-radius:16px;
    padding:16px;
    border:1px solid var(--panel-border);
  }

  .line{display:flex;justify-content:space-between;padding:8px 0;border-top:1px solid var(--line-divider);}
  .line:first-of-type{border-top:0;}

  .val{font-weight:700;}
  .diff{padding:6px 12px;border-radius:10px;text-align:center;font-weight:600;min-width:90px;}
  .zero{background:var(--zero-bg);border:1px dashed var(--zero-border);color:var(--zero-text);}

  textarea{
    width:100%;height:140px;border-radius:10px;padding:10px;font-size:14px;
    border:1px solid var(--border-color);background:var(--card);color:var(--main-text);
  }

  .toggle-row{display:flex;justify-content:space-between;align-items:center;margin:12px 0 6px;font-size:16px;}

  #extraFields{overflow:hidden;max-height:0;padding:0;transition:max-height .35s ease,padding .25s ease;}
  #extraFields.open{max-height:300px;padding:10px 0;}

  /* –°–ª–∞–π–¥–µ—Ä */
  .switch{position:relative;display:inline-block;width:50px;height:28px;}
  .switch input{opacity:0;width:0;height:0;}
  .slider{
    position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;transition:.4s;border-radius:28px;
    background-color:var(--zero-bg);border:1px solid var(--zero-border);
  }
  .slider:before{
    position:absolute;content:"";height:20px;width:20px;left:4px;bottom:3px;background:white;
    transition:.4s;border-radius:50%;
  }
  input:checked + .slider{background-color:var(--accent);border-color:var(--accent);}
  input:checked + .slider:before{transform:translateX(20px);}
</style>
</head>

<body>
<div class="wrap">
  <h1>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤ Uklon</h1>

  <div class="card">
    <label>–§–∞–∫—Ç–∏—á–Ω–∞ —Å—É–º–∞, –≥—Ä–Ω</label>
    <input id="actual" type="number">

    <label>–ü—Ä–æ–±—ñ–≥, –∫–º</label>
    <input id="distance" type="number" step="0.01">

    <label>–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç</label>
    <input id="coef" type="number" step="0.01">

    <label class="toggle-row">
      <span>–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</span>
      <label class="switch">
        <input type="checkbox" id="extraToggle">
        <span class="slider"></span>
      </label>
    </label>

    <div id="extraFields">
      <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–ª–∞—Ç–Ω–∏—Ö —Ö–≤–∏–ª–∏–Ω</label>
      <input id="paidMinutes" type="number">

      <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö —Ç–æ—á–æ–∫</label>
      <input id="midPoints" type="number">
    </div>

    <div class="button-row">
      <button class="small-icon-btn red" id="clearBtn">
        <svg viewBox="0 0 24 24" fill="currentColor" width="20"><path d="M16 9v10H8V9h8m-1.5-6h-5L9 4H7v2h10V4h-2l-1.5-3zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>
      </button>
      <button class="btn" id="calcBtn">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
    </div>
  </div>

  <div class="card">
    <label class="toggle-row">
      <span>–¢–µ–º–Ω–∞ —Ç–µ–º–∞</span>
      <label class="switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
    </label>
  </div>

  <div class="results">
    <div class="panel">
      <h3>–°—Ç–∞–Ω–¥–∞—Ä—Ç</h3>
      <div class="line"><span>–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞</span><span class="val" id="stdCalc">‚Äî</span></div>
      <div class="line"><span>–†—ñ–∑–Ω–∏—Ü—è</span><span class="diff zero" id="stdDiff">‚Äî</span></div>
      <textarea id="stdMsg"></textarea>
      <button class="small-btn" id="copyStd">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
    </div>

    <div class="panel">
      <h3>–ö–æ–º—Ñ–æ—Ä—Ç</h3>
      <div class="line"><span>–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞</span><span class="val" id="cfCalc">‚Äî</span></div>
      <div class="line"><span>–†—ñ–∑–Ω–∏—Ü—è</span><span class="diff zero" id="cfDiff">‚Äî</span></div>
      <textarea id="cfMsg"></textarea>
      <button class="small-btn" id="copyCf">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
    </div>

    <div class="panel">
      <h3>–ë—ñ–∑–Ω–µ—Å</h3>
      <div class="line"><span>–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞</span><span class="val" id="bizCalc">‚Äî</span></div>
      <div class="line"><span>–†—ñ–∑–Ω–∏—Ü—è</span><span class="diff zero" id="bizDiff">‚Äî</span></div>
      <textarea id="bizMsg"></textarea>
      <button class="small-btn" id="copyBiz">–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>

<script>
/* =============== –õ–û–ì–ò–ö–ê –¢–ê–†–ò–§–û–í =============== */
const STD = {minKm:1.9, base:100, perKm:17.6, extraMinute:3, extraPoint:10};
const CFM = {minKm:2.1, base:115, perKm:19.8, extraMinute:3, extraPoint:10};
const BIZ = {minKm:1.6, base:140, perKm:23.5, extraMinute:4, extraPoint:10};

function calcFare(km, t){ return km <= t.minKm ? t.base : t.base + (km - t.minKm) * t.perKm; }
function fmt(x){ return isNaN(x) ? "‚Äî" : x.toFixed(2) + " ‚Ç¥"; }

/* =============== –¶–í–ï–¢ –†–ê–ó–ù–ò–¶–´ =============== */
function colorize(el, v){
  el.className = "diff";
  if(isNaN(v)){ el.classList.add("zero"); el.textContent = "‚Äî"; return;}
  el.textContent = v.toFixed(2) + " ‚Ç¥";

  if(v > 0){ el.style.background = "var(--green)"; el.style.color="var(--good)"; }
  else if(v < 0){ el.style.background="var(--red)"; el.style.color="var(--bad)"; }
  else { el.classList.add("zero"); el.style.background=""; el.style.color=""; }
}

/* =============== –¢–ï–ö–°–¢ –°–û–û–ë–©–ï–ù–ò–Ø =============== */
function getGreeting(){
  const h = new Date().getHours();
  if(h>=5 && h<12) return "–î–æ–±—Ä–æ–≥–æ —Ä–∞–Ω–∫—É!üå§Ô∏è";
  if(h>=12 && h<17) return "–î–æ–±—Ä–æ–≥–æ –¥–Ω—è!üå§Ô∏è";
  if(h>=17 && h<23) return "–î–æ–±—Ä–æ–≥–æ –≤–µ—á–æ—Ä–∞!üåô‚ú®";
  return "–î–æ–±—Ä–æ—ó –Ω–æ—á—ñ!‚ú®üåô";
}

function genMsg(t, km, coef, actual, paid, points){
  let total = calcFare(km,t)*coef;
  let lines = [`‚Ä¢ –ë–∞–∑–æ–≤–∏–π —Ç–∞—Ä–∏—Ñ = ${(calcFare(km,t)*coef).toFixed(2)} –≥—Ä–Ω`];

  if(paid>0){ total += paid*t.extraMinute; lines.push(`‚Ä¢ –ü–ª–∞—Ç–Ω—ñ —Ö–≤–∏–ª–∏–Ω–∏ = ${(paid*t.extraMinute).toFixed(2)} –≥—Ä–Ω`); }
  if(points>0){ total += points*t.extraPoint; lines.push(`‚Ä¢ –ü—Ä–æ–º—ñ–∂–Ω—ñ —Ç–æ—á–∫–∏ = ${(points*t.extraPoint).toFixed(2)} –≥—Ä–Ω`); }

  let diff = total - actual;
  if(diff <= 0) return "";

  return `${getGreeting()}
–ü—Ä–æ—à—É –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫.
–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∞ —Å—É–º–∞: ${total.toFixed(2)} –≥—Ä–Ω
${lines.join("\n")}
–§–∞–∫—Ç–∏—á–Ω–∞: ${actual.toFixed(2)} –≥—Ä–Ω
–î–æ–Ω–∞—Ä–∞—Ö—É–≤–∞—Ç–∏: ${diff.toFixed(2)} –≥—Ä–Ω.
–î—è–∫—É—é!`;
}

/* =============== –ö–û–ü–ò–†–û–í–ê–ù–ò–ï =============== */
function bindCopy(btn, ta){
  document.getElementById(btn).onclick = () => {
    let t = document.getElementById(ta);
    if(!t.value) return alert('–ù–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è');
    t.select(); navigator.clipboard.writeText(t.value); alert('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ');
  };
}
bindCopy("copyStd","stdMsg");
bindCopy("copyCf","cfMsg");
bindCopy("copyBiz","bizMsg");

/* =============== –ö–ù–û–ü–ö–ê –†–ê–°–ß–Å–¢–ê =============== */
document.getElementById("calcBtn").onclick = function(){
  const actual = parseFloat(actual.value);
  const km = parseFloat(distance.value);
  const coef = parseFloat(coef.value);
  const paid = parseInt(paidMinutes.value)||0;
  const points = parseInt(midPoints.value)||0;

  if(isNaN(actual)||isNaN(km)||isNaN(coef)) return alert("–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ");

  const totals = {
    std: calcFare(km,STD)*coef + paid*STD.extraMinute + points*STD.extraPoint,
    cf: calcFare(km,CFM)*coef + paid*CFM.extraMinute + points*CFM.extraPoint,
    biz: calcFare(km,BIZ)*coef + paid*BIZ.extraMinute + points*BIZ.extraPoint
  };

  stdCalc.textContent = fmt(totals.std);
  cfCalc.textContent  = fmt(totals.cf);
  bizCalc.textContent = fmt(totals.biz);

  colorize(stdDiff, actual - totals.std);
  colorize(cfDiff,  actual - totals.cf);
  colorize(bizDiff, actual - totals.biz);

  stdMsg.value = genMsg(STD, km, coef, actual, paid, points);
  cfMsg.value = genMsg(CFM, km, coef, actual, paid, points);
  bizMsg.value = genMsg(BIZ, km, coef, actual, paid, points);
};

/* =============== –û–ß–ò–°–¢–ö–ê =============== */
clearBtn.onclick = () => {
  actual.value=""; distance.value=""; coef.value="";
  paidMinutes.value=""; midPoints.value="";
  stdCalc.textContent=cfCalc.textContent=bizCalc.textContent="‚Äî";
  stdMsg.value=cfMsg.value=bizMsg.value="";
  colorize(stdDiff,NaN); colorize(cfDiff,NaN); colorize(bizDiff,NaN);
  extraToggle.checked=false; extraFields.classList.remove("open");
};

/* =============== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–û–õ–Ø =============== */
extraToggle.onchange = () => {
  if(extraToggle.checked) extraFields.classList.add("open");
  else{
    extraFields.classList.remove("open");
    paidMinutes.value=""; midPoints.value="";
  }
};

/* ===========================================================
          *** –ü–†–û–°–¢–û–ô –ò –ü–†–ê–í–ò–õ–¨